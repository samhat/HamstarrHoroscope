# HamstarrHoroscope design doc

## Overview
Build a Twitter bot that dispenses cute affirmations and horoscopes in the voice of Hamstarr, fortune-telling hamster from Hamtaro: Rainbow Rescue (GBA). These horoscopes will be delivered as faux-screenshots from the GBA game, generated by the bot through scripting.

## Functionality
At some regular interval (likely once a day), the bot tweets a horoscope, using the following steps:
* loads text for a horoscope, picked randomly (or semi-randomly, to avoid duplicates) from a list of messages in a text file
* generates the horoscope image using a template sourced from game screenshots and ImageMagick scripting
* tweets that image to the bot’s account using the Twitter API

The bot might also have the following features:
* accept additions to the horoscope list through direct messages from trusted friends (i.e. the bot would only follow certain handlers)
	* Example DM to bot: 
	
        User: <add “If every porkchop were perfect, we wouldn’t have hot dogs.”>
	
        Bot: <Your horoscope was added♪>
* allow testing of new messages through direct messages
	* Example conversation:
	
        User: <test “SomeBODY once told me the world is gonna roll me, I ain’t the sharpest tool in the shed. She was looking kinda dumb with her finger and her thumb in the shape of an L on her forehead…”>
	
        Bot: <Sorry, that message doesn’t fit in the text box♪>
    
* perform a mass test over the main data file, and report horoscopes that don’t fit
* accept horoscope suggestions from untrusted users, and allow admins to review new suggestions
	* Don’t have any plans on how to do this yet
* allow, generate and post multi-page (i.e. multi-image) horoscopes
* post animated GIF horoscopes, rather than static images

## Implementation
* bmelts has created a TTF font file for the pixel font used in Hamtaro: Rainbow Rescue’s text boxes, and has also created a few screenshot templates for horoscopes
	* Text should be 32-point font at an upper-left origin of 32 pixels horizontal, 216 pixels vertical
	* Also, spaces are 16 pixels wide in the game, but we’ve noticed that they default to a different size (12 pixels) in some cases. (ImageMagick can correct for this using the interword-spacing option.)
	* The text box is roughly 390 pixels wide by 80 pixels tall (could be remeasured)
		* Note: in some game screenshots, text on the top line occupies an area that would collide with the “press A” graphic if it was in the bottom two lines. Coding-wise, it might be easier to not use that extra space, so it’s not included in this measurement.
	* Given that the maximum width of a non-space character is 14 pixels, a conservative estimate for filling the text box is 85-90 characters. However, the limit could be larger or smaller than this, depending on the ratio of thin to thick characters, or if very long words wrap to the next line.
* samhat/hatatk has written commands for the image processing library ImageMagick to generate horoscope screenshots
	* First command creates image with text in the Hamtaro font
        
      Ex: `convert -background transparent -fill black -font Hamtaro.ttf -pointsize 32 -size 390x80 -interword-spacing 16 caption:"Don't stay up late tonight. Go to bed early so you can enjoy a nice dream." caption.png`
      
      * More info here: [Text Handling — IM v6 Examples](https://www.imagemagick.org/Usage/text/#caption)
	* Second command overlays the text onto a template
  
      Ex: `composite -geometry +32+216 caption.png hamstarr_blank_blue.png caption_and_bg.png`
      
      * More info here: [Annotating — IM v6 Examples](https://www.imagemagick.org/Usage/annotating/#overlay)

## Tasks
* Determine format for data file
* Create Python script to manage bot
	* Create skeleton of script: divide into functions, etc.
	* Load data file and select random message for horoscope
		* Nice to have: don’t pick same horoscope twice until all other horoscopes have been picked
	* Test method to determine whether a horoscope will fit in the box
		* I have an idea on how to do this: if you supply a width but not a height when using the “caption:” text generator, it will scale the image’s height to as many lines as necessary to capture the input. So, the test message could just create a test image using only the width of the box, and then check to make sure the height of the test image is less than or equal to the height of the template text box
	* Call ImageMagick to generate horoscope image
		* Nice to have: create animated GIFs instead of static images
	* Post image to Twitter
		* Nice to have: for accessibility, we could try to see if the Twitter API lets us add alt text to the images for the visually impaired
	* Other script features as mentioned in the functionality section
* Look into options for hosting and report to team
* Set up hosting for bot
* Set up Twitter account for bot
* Testing bot to confirm everything works
* Write profile info for bot
* Create profile pic and cover image for bot
* Gather horoscopes from original game
* Write original horoscopes and affirmations

## Resources
[Tutorials for Twitter Bots | botwiki](https://botwiki.org/tutorials/twitterbots/)

[Convert, Edit, Or Compose Bitmap Images @ ImageMagick](https://www.imagemagick.org/script/index.php) - ImageMagick home page

[Text Handling — IM v6 Examples](https://www.imagemagick.org/Usage/text/#caption) - info on the text generation script command

[Annotating — IM v6 Examples](https://www.imagemagick.org/Usage/annotating/#overlay) - info on the overlaying command

[BitFontMaker2™ BitMap Font Editor](http://www.pentacom.jp/pentacom/bitfontmaker2/) - the font generator bmelts used

[Hamtaro: Rainbow Rescue](https://lparchive.org/Hamtaro-Rainbow-Rescue/) - a Let's Play of the game

https://lparchive.org/Hamtaro-Rainbow-Rescue/Update%2013/27-Hamstarr.gif - Animated GIF of Hamstarr (not sure if it’s a perfect loop tho…)
